<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RQ3 Display</title>
    
    <!-- 引入Prism.js用于代码高亮 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-java.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .table-container {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed; /* 强制列宽固定 */
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #f4f4f4;
            text-align: center; /* 表头居中 */
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:nth-child(odd) {
            background-color: #fff;
        }

        .toggle-buttons {
            margin-bottom: 10px;
        }

        .toggle-buttons button {
            padding: 10px;
            margin-right: 10px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }

        .toggle-buttons button.active {
            background-color: #0056b3;
        }

        /* 标签列居中对齐 */
        .category-tag {
            display: block;
            padding: 5px;
            margin: 2px 0;
            border-radius: 5px;
            color: white;
            font-size: 0.9em;
            text-align: center; /* 标签居中 */
        }

        /* 设置列宽度 */
        .id-col {
            width: 2%;
            text-align: center; 
        }

        .title-col {
            width: 10%;
            word-wrap: break-word;
            text-align: center; 
        }

        .description-col {
            width: 18%;
            word-wrap: break-word;
        }

        .category-col {
            width: 7%;
        }

        .template-col, .code-col {
            width: 25%;
        }

        /* Prism.js 的代码块样式 */
        pre {
            white-space: pre-wrap; /* 保留换行符 */
            word-wrap: break-word; /* 防止溢出 */
            background-color: #f4f4f4; /* 背景色 */
            padding: 10px; /* 代码块内边距 */
            border-radius: 5px; /* 代码块圆角 */
            font-family: "Courier New", Courier, monospace;
        }
    </style>
</head>
<body>

<h1>RQ3 Data Display</h1>

<div class="toggle-buttons">
    <button id="nkButton" onclick="loadAndDisplayExcel('rq3_nk.xls', 'nkTable')">Show NowCoder Data</button>
    <button id="lcButton" onclick="loadAndDisplayExcel('rq3_lc.xls', 'lcTable')">Show LeetCode Data</button>
</div>

<div class="filter-container">
    <label for="tagFilter">Filter by tag:</label>
    <select id="tagFilter">
        <option value="">--Select a tag--</option>
    </select>
</div>

<div class="table-container">
    <!-- Table for rq3_nk.xls -->
    <table id="nkTable" style="display: none;">
        <thead id="nkHeader"></thead>
        <tbody id="nkData"></tbody>
    </table>

    <!-- Table for rq3_lc.xls -->
    <table id="lcTable" style="display: none;">
        <thead id="lcHeader"></thead>
        <tbody id="lcData"></tbody>
    </table>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
    // 标签颜色映射表
    const tagColorMap = {};
    const colors = [
        '#6c757d', '#28a745', '#17a2b8', '#ffc107', '#dc3545', '#007bff', '#fd7e14', '#20c997', '#e83e8c', '#6610f2',
        '#343a40', '#795548', '#607d8b', '#f44336', '#00bcd4', '#3f51b5', '#ff5722', '#009688', '#673ab7', '#cddc39'
    ];

    // 表头对应英文名
    const headers = ['No', 'Problem Title', 'Problem Description', 'Tags', 'Code Template Generated by AdaptGen', 'Accepted Code Generated by ChatGPT'];

    // 标签选项
    let allTags = new Set();

    function loadAndDisplayExcel(fileName, tableId) {
        const table = document.getElementById(tableId);
        const tbody = document.getElementById(tableId === 'nkTable' ? 'nkData' : 'lcData');
        const thead = document.getElementById(tableId === 'nkTable' ? 'nkHeader' : 'lcHeader');

        tbody.innerHTML = '';
        thead.innerHTML = '';

        allTags = new Set();

        const xhr = new XMLHttpRequest();
        xhr.open('GET', fileName, true);
        xhr.responseType = 'arraybuffer';

        xhr.onload = function () {
            const data = new Uint8Array(xhr.response);
            const workbook = XLSX.read(data, {type: 'array'});

            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];

            const jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1});

            // 添加表头
            const headerRow = document.createElement('tr');
            headers.forEach((header, index) => {
                const th = document.createElement('th');
                th.textContent = header;

                // 设置列宽
                if (index === 0) th.classList.add('id-col'); // 编号列
                if (index === 1) th.classList.add('title-col'); // 题目列
                if (index === 2) th.classList.add('description-col'); // 问题描述列
                if (index === 3) th.classList.add('category-col'); // 分类列
                if (index === 4 || index === 5) th.classList.add('template-col');  // 模板与代码列

                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // 填充数据并为每行加上编号
            jsonData.slice(1, 51).forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                const numberCell = document.createElement('td');
                numberCell.textContent = rowIndex + 1;  // 编号从1开始
                numberCell.classList.add('id-col'); 
                tr.appendChild(numberCell);

                row.forEach((cell, colIndex) => {
                    const td = document.createElement('td');

                    if (colIndex === 5) return;

                    if (colIndex === 0) {
                        td.classList.add('title-col');
                        const a = document.createElement('a');
                        a.textContent = cell;
                        // 将 URL 设置为第6列的值
                        const url = row[5]; // 获取第6列 (URL) 的值
                        if (url) {
                            a.href = url;
                            a.target = '_blank'; // 在新标签页中打开链接
                        }
                        td.appendChild(a);
                    } else if (colIndex === 2) { // 处理分类列
                        const tags = cell.split('\n');
                        tags.forEach(tag => {
                            const span = document.createElement('span');
                            tag = tag.trim();
                            span.textContent = tag;

                            // 分配颜色
                            if (!tagColorMap[tag]) {
                                tagColorMap[tag] = colors[Object.keys(tagColorMap).length % colors.length];
                            }
                            span.style.backgroundColor = tagColorMap[tag];

                            span.classList.add('category-tag');
                            td.appendChild(span);

                            // 收集所有标签
                            allTags.add(tag);
                        });
                    } else if (colIndex === 3 || colIndex === 4) { // 模板或代码列
                        const pre = document.createElement('pre');
                        pre.classList.add('language-java');  // 指定代码类型为Java
                        pre.innerHTML = Prism.highlight(cell || '', Prism.languages.java, 'java'); // 代码高亮
                        td.appendChild(pre);
                    } else if (colIndex) {
                        td.textContent = cell || '';
                    }

                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            // 更新标签选择器
            updateTagFilter();

            document.getElementById('nkTable').style.display = 'none';
            document.getElementById('lcTable').style.display = 'none';
            table.style.display = 'table';

            document.getElementById('nkButton').classList.remove('active');
            document.getElementById('lcButton').classList.remove('active');

            if (tableId === 'nkTable') {
                document.getElementById('nkButton').classList.add('active');
            } else {
                document.getElementById('lcButton').classList.add('active');
            }
        };

        xhr.send();
    }

    function updateTagFilter() {
        const tagFilter = document.getElementById('tagFilter');
        tagFilter.innerHTML = '<option value="">--Select a tag--</option>'; // 重新填充下拉列表
        allTags.forEach(tag => {
            const option = document.createElement('option');
            option.value = tag;
            option.textContent = tag;
            tagFilter.appendChild(option);
        });
    }

    function filterByTag() {
        const selectedTag = document.getElementById('tagFilter').value;
        const tables = ['nkTable', 'lcTable'];
        tables.forEach(tableId => {
            const table = document.getElementById(tableId);
            const tbody = document.getElementById(tableId === 'nkTable' ? 'nkData' : 'lcData');
            const rows = tbody.querySelectorAll('tr');

            rows.forEach(row => {
                const tags = row.querySelectorAll('.category-tag');
                const hasTag = Array.from(tags).some(tag => tag.textContent === selectedTag || selectedTag === '');
                row.style.display = hasTag ? '' : 'none';
            });
        });
    }

    document.getElementById('tagFilter').addEventListener('change', filterByTag);

    // 默认显示lc数据集
    window.onload = function() {
        loadAndDisplayExcel('rq3_lc.xls', 'lcTable');
    };
</script>

</body>
</html>